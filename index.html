<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WheelHouse - Options Strategy Analyzer</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè†</text></svg>">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <div style="display:flex; justify-content:center; align-items:center; gap:10px;">
            <h1>üè† WheelHouse</h1>
            <button id="settingsBtn" onclick="showSettingsModal()" style="background:none; border:none; font-size:18px; cursor:pointer; opacity:0.6; transition:opacity 0.2s;" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.6" title="Theme Settings">‚öôÔ∏è</button>
            <button id="restartBtn" onclick="restartServer()" style="background:none; border:none; font-size:16px; cursor:pointer; opacity:0.6; transition:opacity 0.2s;" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.6" title="Restart Server">üîÑ</button>
        </div>
        <p class="subtitle">Wheel Strategy Options Analyzer</p>
        
        <div class="tabs">
            <button class="tab-btn active" data-tab="positions">üìã Positions</button>
            <button class="tab-btn" data-tab="portfolio">üíº Portfolio</button>
            <button class="tab-btn" data-tab="challenges">üèÜ Challenges</button>
            <button class="tab-btn" data-tab="options">üìà Options</button>
            <button class="tab-btn" data-tab="pnl">üí∞ P&L</button>
            <button class="tab-btn" data-tab="greeks">Œî Greeks</button>
            <button class="tab-btn" data-tab="data">üìä Data</button>
            <button class="tab-btn" data-tab="simulator">üî¨ Simulator</button>
            <button class="tab-btn" data-tab="settings">‚öôÔ∏è Settings</button>
        </div>

        <!-- SIMULATOR TAB -->
        <div class="tab-content" id="simulator">
            <div class="main-grid">
                <div class="canvas-section">
                    <canvas id="mainCanvas" width="800" height="220"></canvas>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-color" style="background:var(--accent-green)"></div>Path</div>
                        <div class="legend-item"><div class="legend-color" style="background:rgba(0,217,255,0.4)"></div>Previous</div>
                        <div class="legend-item"><div class="legend-color" style="background:var(--accent-red)"></div>Walls</div>
                        <div class="legend-item"><div class="legend-color" style="background:var(--accent-orange)"></div>Start</div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-value" id="simCount">0</div><div class="stat-label">Simulations</div></div>
                        <div class="stat-card"><div class="stat-value" id="avgTau">‚Äî</div><div class="stat-label">Avg Exit (days)</div></div>
                        <div class="stat-card" style="background:rgba(255,82,82,0.15)"><div class="stat-value" id="hitZero">0%</div><div class="stat-label">ITM at Expiry</div></div>
                        <div class="stat-card" style="background:rgba(0,255,136,0.15)"><div class="stat-value" id="hitOne">0%</div><div class="stat-label">OTM at Expiry</div></div>
                    </div>
                    <canvas id="histogramCanvas" height="60" style="margin-top:8px"></canvas>
                    <div id="batchStats" style="margin-top: 10px;"></div>
                </div>
                <div class="controls-panel">
                    <div class="control-group">
                        <label>p (Starting Position) <input type="number" class="value-input" id="pInput" min="0.01" max="0.99" step="0.01" value="0.50"></label>
                        <input type="range" id="pSlider" min="0.01" max="0.99" step="0.01" value="0.5">
                    </div>
                    <div class="control-group">
                        <label>q (Drift) <input type="number" class="value-input" id="qInput" min="0" max="2" step="0.01" value="0.50"></label>
                        <input type="range" id="qSlider" min="0" max="2" step="0.01" value="0.5">
                    </div>
                    <div class="control-group">
                        <label>œÉ (Volatility) <input type="number" class="value-input" id="sigmaInput" min="0.01" max="0.5" step="0.01" value="0.10"></label>
                        <input type="range" id="sigmaSlider" min="0.01" max="0.5" step="0.01" value="0.1">
                    </div>
                    <div class="control-group">
                        <label>Paths per Batch <span class="value-display" id="pathsInput">1000</span></label>
                        <input type="range" id="pathsSlider" min="100" max="10000" step="100" value="1000">
                    </div>
                    
                    <div style="display: flex; gap: 8px; margin-top: 15px;">
                        <button class="btn-primary" id="runSingleBtn" style="flex: 1;">‚ñ∂ Single</button>
                        <button class="btn-primary" id="runBatchBtn" style="flex: 1;">‚ö° Batch</button>
                        <button class="btn-danger" id="resetBtn" style="flex: 1;">üóë Reset</button>
                    </div>
                    
                    <div class="running" id="runningIndicator"><div class="spinner"></div>Running...</div>
                    <div class="progress-bar" id="progressBar" style="display:none"><div class="progress-fill" id="progressFill"></div></div>
                </div>
            </div>
        </div>

        <!-- OPTIONS TAB -->
        <div class="tab-content" id="options">
            <!-- Position Context Banner -->
            <div id="positionContext" style="display:none; background:rgba(0,217,255,0.15); border:2px solid var(--accent-cyan); border-radius:6px; padding:8px 12px; margin-bottom:8px;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div style="display:flex; align-items:center; gap:15px;">
                        <div style="color:var(--accent-cyan); font-weight:600; font-size:12px;">üìä ANALYZING POSITION</div>
                        <div id="contextTicker" style="font-weight:bold; color:#fff; font-size:14px;">‚Äî</div>
                        <div id="contextDetails" style="color:#888; font-size:12px;">‚Äî</div>
                    </div>
                    <button id="clearContextBtn" class="btn-secondary" style="padding:4px 8px; font-size:11px;">‚úï Clear</button>
                </div>
            </div>
            
            <div class="options-layout">
                <!-- LEFT: Inputs -->
                <div class="options-inputs">
                    <div class="control-group">
                        <label>Ticker</label>
                        <div style="display:flex; gap:4px;">
                            <input type="text" id="tickerInput" placeholder="AAPL..." style="flex:1; padding:5px; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.2); border-radius:4px; color:#fff; text-transform:uppercase; font-size:12px;">
                            <button id="fetchTickerBtn" class="btn-secondary" style="padding:5px 8px; font-size:11px;">üìä</button>
                        </div>
                        <div id="priceStatus" style="font-size:10px; color:#888; margin-top:2px;"></div>
                    </div>
                    
                    <div class="control-group">
                        <label>Spot (S‚ÇÄ) <input type="number" id="spotInput" class="value-input" min="1" max="1000" step="1" value="100"></label>
                        <input type="range" id="spotSlider" min="20" max="500" step="1" value="100">
                    </div>
                    <div class="control-group">
                        <label>Strike (K) <input type="number" id="strikeInput" class="value-input" min="1" max="1000" step="1" value="100"></label>
                        <input type="range" id="strikeSlider" min="20" max="500" step="1" value="100">
                    </div>
                    <div class="control-group">
                        <label>Lower Barrier <input type="number" id="lowerInput" class="value-input" min="1" max="500" step="1" value="80"></label>
                        <input type="range" id="lowerSlider" min="10" max="480" step="1" value="80">
                    </div>
                    <div class="control-group">
                        <label>Upper Barrier <input type="number" id="upperInput" class="value-input" min="1" max="1000" step="1" value="120"></label>
                        <input type="range" id="upperSlider" min="30" max="600" step="1" value="120">
                    </div>
                    <div class="control-group">
                        <label>Volatility (œÉ) <input type="number" id="optVolInput" class="value-input" min="5" max="200" step="1" value="20" style="width:40px;">%</label>
                        <input type="range" id="optVolSlider" min="0.05" max="1.5" step="0.01" value="0.2">
                    </div>
                    <div class="control-group">
                        <label>DTE <input type="number" id="dteInput" class="value-input" min="1" max="730" step="1" value="30"></label>
                        <input type="range" id="dteSlider" min="1" max="365" step="1" value="30">
                    </div>
                    <div class="control-group">
                        <label>üìÖ Expiry</label>
                        <input type="date" id="expiryDatePicker" style="width:100%; padding:4px; background:rgba(0,217,255,0.15); border:1px solid rgba(0,217,255,0.3); border-radius:4px; color:#fff; font-size:11px;">
                        <div id="dteDisplay" style="font-size:11px; color:var(--accent-orange); margin-top:2px;"></div>
                    </div>
                    
                    <div style="display:flex; gap:6px; margin-top:10px; align-items:center;">
                        <label style="display:flex; align-items:center; gap:4px; font-size:11px; cursor:pointer;" title="Fetch live spot price and IV from CBOE before pricing">
                            <input type="checkbox" id="syncCheckbox" checked style="cursor:pointer;">
                            üì° Live
                        </label>
                        <button id="priceBtn" class="btn-primary" style="flex:2; padding:6px; font-size:12px;">üíµ Price Options</button>
                    </div>
                    <div class="running" id="optRunning"><div class="spinner"></div>Pricing...</div>
                </div>
                
                <!-- CENTER: Charts -->
                <div class="options-charts">
                    <div id="positionInfo" style="font-size:11px; margin-bottom:4px;"></div>
                    <canvas id="payoffCanvas" style="width:100%; height:220px;"></canvas>
                    <div class="legend" style="font-size:10px; margin:4px 0;">
                        <div class="legend-item"><div class="legend-color" style="background:var(--accent-green)"></div>Call</div>
                        <div class="legend-item"><div class="legend-color" style="background:var(--accent-red)"></div>Put</div>
                        <div class="legend-item"><div class="legend-color" style="background:var(--accent-cyan)"></div>Strike</div>
                        <div class="legend-item"><div class="legend-color" style="background:var(--accent-orange)"></div>Barriers</div>
                    </div>
                    <canvas id="priceHistCanvas" style="width:100%; height:80px; margin-top:4px"></canvas>
                </div>
                
                <!-- RIGHT: Results -->
                <div class="options-results">
                    <div class="results-box options" style="margin-bottom:8px;">
                        <h3 style="font-size:12px; display:flex; justify-content:space-between; align-items:center;">
                            <span>üí∞ Option Prices</span>
                            <span id="priceSource" style="font-size:9px; color:#888;"></span>
                        </h3>
                        <div class="payoff-grid">
                            <div class="payoff-card call"><div class="payoff-label">CALL</div><div class="payoff-value" id="callPrice" title="Hover for bid/ask">‚Äî</div></div>
                            <div class="payoff-card put"><div class="payoff-label">PUT</div><div class="payoff-value" id="putPrice" title="Hover for bid/ask">‚Äî</div></div>
                        </div>
                        <div class="result-row"><span class="result-label">‚è±Ô∏è Time:</span><span class="result-value" id="optTau">‚Äî</span></div>
                        <div class="result-row"><span class="result-label">üìâ Below Strike:</span><span class="result-value put" id="optLower">‚Äî</span></div>
                        <div class="result-row"><span class="result-label">üìà Above Strike:</span><span class="result-value call" id="optUpper">‚Äî</span></div>
                    </div>
                    
                    <div id="recommendation" class="recommendation-box" style="display:none; margin-bottom:8px;">
                        <h3 id="recTitle" style="font-size:12px;">ü§ñ Recommendation</h3>
                        <div class="action" id="recAction" style="font-size:11px;"></div>
                        <div class="reason" id="recReason" style="font-size:11px;"></div>
                        <div class="tip" id="recTip" style="font-size:10px;"></div>
                    </div>
                    
                    <div class="results-box" id="worthItBox" style="display:none;">
                        <h3 style="font-size:12px;">üéØ Trade Metrics</h3>
                        <div class="metrics-grid">
                            <div class="result-row"><span class="result-label">ROC:</span><span class="result-value" id="rocDisplay">‚Äî</span></div>
                            <div class="result-row"><span class="result-label">Annualized ROC:</span><span class="result-value" id="annRocDisplay">‚Äî</span></div>
                            <div class="result-row"><span class="result-label">Risk:Reward:</span><span class="result-value" id="riskRewardRatio">‚Äî</span></div>
                            <div class="result-row"><span class="result-label">Win Probability:</span><span class="result-value" id="winProbability">‚Äî</span></div>
                            <div class="result-row"><span class="result-label">Required Win Rate:</span><span class="result-value" id="requiredWinRate">‚Äî</span></div>
                            <div class="result-row"><span class="result-label">Your Edge:</span><span class="result-value" id="yourEdge">‚Äî</span></div>
                            <div class="result-row"><span class="result-label">Kelly %:</span><span class="result-value" id="kellyPct">‚Äî</span></div>
                        </div>
                        <div style="border-top:1px dashed rgba(255,255,255,0.2); margin-top:6px; padding-top:6px;">
                            <div class="result-row"><span class="result-label" title="Average stock price in Monte Carlo scenarios where you get assigned (stock ends below strike for puts)">Avg if Assigned:</span><span class="result-value" id="avgIfAssigned">‚Äî</span></div>
                            <div class="result-row"><span class="result-label" title="Average loss when assigned = (Strike - Avg Price - Premium) √ó 100 √ó Contracts. This is a realistic loss estimate based on simulation, not worst-case.">Expected Loss:</span><span class="result-value put" id="expectedLoss">‚Äî</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- P&L TAB - New Wide Layout -->
        <div class="tab-content" id="pnl">
            <div class="pnl-layout">
                <!-- LEFT: Charts (narrower) -->
                <div class="pnl-charts">
                    <h3 style="color:var(--accent-cyan); margin-bottom:4px; font-size:13px;">üí∞ P&L at Expiration</h3>
                    <canvas id="pnlCanvas" width="600" height="120"></canvas>
                    
                    <h3 style="color:var(--accent-cyan); margin:8px 0 4px; font-size:13px;">üìä Probability Cone</h3>
                    <canvas id="probConeCanvas" width="600" height="110"></canvas>
                    
                    <div style="display:flex; align-items:center; gap:10px; margin:8px 0 4px;">
                        <h3 style="color:var(--accent-cyan); margin:0; font-size:13px;">üî• Heat Map</h3>
                        <div style="display:flex; align-items:center; gap:6px; margin-left:auto;">
                            <label style="font-size:12px; color:var(--accent-orange);">Spot $</label>
                            <input type="number" id="heatMapSpot" class="value-input" step="0.01" style="width:70px; padding:4px;">
                            <button id="heatMapFetchBtn" class="btn-secondary" style="padding:4px 8px; font-size:11px;" title="Fetch live price">üìä</button>
                            <button id="heatMapUpdateBtn" class="btn-primary" style="padding:4px 10px; font-size:11px;">Update</button>
                        </div>
                    </div>
                    <canvas id="heatMapCanvas" width="600" height="120"></canvas>
                    
                    <!-- Break-Even Analysis -->
                    <div class="results-box" style="padding:10px; margin-top:10px;">
                        <h3 style="font-size:13px; margin-bottom:8px;">üìä Break-Even Analysis</h3>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                            <div class="result-row" style="padding:4px 0; font-size:13px;"><span class="result-label">Break-Even:</span><span class="result-value" id="breakEvenPrice">‚Äî</span></div>
                            <div class="result-row" style="padding:4px 0; font-size:13px;"><span class="result-label">Max Profit:</span><span class="result-value call" id="maxProfit">‚Äî</span></div>
                            <div class="result-row" style="padding:4px 0; font-size:13px;"><span class="result-label">Max Loss:</span><span class="result-value put" id="maxLoss">‚Äî</span></div>
                            <div class="result-row" style="padding:4px 0; font-size:13px;"><span class="result-label">Expected Value:</span><span class="result-value" id="expectedValue">‚Äî</span></div>
                        </div>
                    </div>
                </div>
                
                <!-- MIDDLE: Roll Calculator & Suggestions -->
                <div class="pnl-roll-calc">
                    <h3 style="color:var(--accent-green); margin-bottom:8px; font-size:13px;">üîÑ Roll Calculator</h3>
                    
                    <!-- Current Position Info - Compact -->
                    <div style="background:rgba(255,170,0,0.15); padding:8px; border-radius:4px; margin-bottom:10px; font-size:12px;">
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:3px;">
                            <span>Strike: $<span id="rollCurrentStrike">‚Äî</span></span>
                            <span>DTE: <span id="rollCurrentDte">‚Äî</span>d</span>
                            <span>Risk: <span id="rollCurrentRisk">‚Äî</span>%</span>
                            <span>Prem: $<span id="rollCurrentPremium">‚Äî</span></span>
                        </div>
                    </div>
                    
                    <!-- Roll Inputs - Compact 4-col -->
                    <div style="display:grid; grid-template-columns:1fr 1fr 1fr 1fr; gap:6px; margin-bottom:8px;">
                        <div class="control-group">
                            <label style="font-size:10px;">Strike</label>
                            <input type="number" id="rollNewStrike" class="value-input" min="1" max="500" step="0.5" value="95" style="width:100%; padding:5px; font-size:12px;">
                        </div>
                        <div class="control-group">
                            <label style="font-size:10px;">DTE</label>
                            <input type="number" id="rollNewDte" class="value-input" min="1" max="365" step="1" value="45" style="width:100%; padding:5px; font-size:12px;">
                        </div>
                        <div class="control-group">
                            <label style="font-size:10px;">üìÖ Expiry</label>
                            <input type="date" id="rollNewExpiry" style="width:100%; padding:5px; background:rgba(0,217,255,0.15); border:1px solid rgba(0,217,255,0.3); border-radius:4px; color:#fff; font-size:11px;">
                        </div>
                        <div class="control-group">
                            <label style="font-size:10px;">Cr/Dr $</label>
                            <input type="number" id="rollCredit" class="value-input" min="-10000" max="10000" step="1" value="50" style="width:100%; padding:5px; font-size:12px;" title="Total. Negative = debit">
                        </div>
                    </div>
                    <div style="display:flex; gap:6px; margin-bottom:10px;">
                        <button id="rollBtn" class="btn-primary" style="flex:1; padding:6px; font-size:12px;">üßÆ Calc</button>
                        <button id="suggestRollBtn" class="btn-primary" style="flex:1; padding:6px; font-size:12px; background:linear-gradient(135deg, #8b5cf6, #6366f1);">‚ú® Suggest</button>
                    </div>
                    
                    <!-- Roll Results - Compact -->
                    <div id="rollResults" style="padding:8px; background:rgba(0,0,0,0.3); border-radius:4px; font-size:12px; margin-bottom:10px;">
                        <div style="display:grid; grid-template-columns:1fr 1fr 1fr 1fr; gap:4px; font-size:11px;">
                            <div class="result-row"><span class="result-label">Strike</span><span class="result-value" id="rollNewStrikeDisp">‚Äî</span></div>
                            <div class="result-row"><span class="result-label">DTE</span><span class="result-value" id="rollNewDteDisp">‚Äî</span></div>
                            <div class="result-row"><span class="result-label">Risk</span><span class="result-value put" id="rollNewRisk">‚Äî</span></div>
                            <div class="result-row"><span class="result-label">Prem</span><span class="result-value call" id="rollTotalPremium">‚Äî</span></div>
                        </div>
                        <div class="result-row" style="margin-top:6px; padding-top:6px; border-top:1px solid #333; display:flex; justify-content:space-between;">
                            <span class="result-label">Net Result:</span>
                            <span class="result-value" id="rollNetCredit" style="font-size:14px; font-weight:bold;">‚Äî</span>
                        </div>
                        <div id="rollComparison" style="margin-top:6px; padding:6px; background:rgba(0,217,255,0.15); border-radius:4px; font-size:11px; color:#888;">Click Calculate or pick a suggestion</div>
                    </div>
                    
                    <!-- Suggestions -->
                    <div id="rollSuggestions" style="display:none; padding:8px; background:rgba(139,92,246,0.15); border:1px solid rgba(139,92,246,0.3); border-radius:4px; font-size:11px;">
                        <div style="color:#8b5cf6; font-weight:bold; margin-bottom:6px; font-size:12px;">‚ú® Roll Suggestions</div>
                        <div id="rollSuggestionsList"></div>
                    </div>
                </div>
                
                <!-- RIGHT: Expert Analysis -->
                <div class="pnl-expert">
                    <h3 style="color:var(--accent-orange); margin-bottom:8px; font-size:13px;">ü§ñ Expert Analysis</h3>
                    <div id="expertAnalysis">
                        <div style="color:#888; font-size:12px; padding:15px; text-align:center;">
                            Load a position and click<br><b>‚ú® Suggest</b> to see analysis
                        </div>
                    </div>
                    
                    <!-- AI Insights (Ollama) -->
                    <div id="aiInsightsPanel" style="margin-top:12px; padding:10px; background:rgba(0,217,255,0.08); border:1px solid rgba(0,217,255,0.3); border-radius:6px; max-height:400px; overflow-y:auto;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                            <span style="color:var(--accent-cyan); font-weight:bold; font-size:12px;">üß† AI Trade Advisor</span>
                            <button id="aiInsightBtn" onclick="getAIInsight()" class="btn-mini" style="font-size:10px; padding:3px 8px;">üí° Get Insight</button>
                        </div>
                        <div style="display:flex; align-items:center; gap:6px; margin-bottom:8px;">
                            <label style="font-size:10px; color:#888;">Model: <span style="color:#555; font-size:9px;">(7B best for roll/hold)</span></label>
                            <select id="aiModelSelect" onchange="saveAIModelPreference()" style="font-size:10px; padding:2px 4px; background:#1a1a2e; color:#ddd; border:1px solid #444; border-radius:3px;">
                                <option value="qwen2.5:7b" selected>Qwen 7B ‚≠ê</option>
                                <option value="qwen2.5:14b">Qwen 14B</option>
                                <option value="qwen2.5:32b">Qwen 32B</option>
                                <option value="llama3.1:8b">Llama 3.1 8B</option>
                                <option value="mistral:7b">Mistral 7B</option>
                            </select>
                            <span id="aiModelStatus" style="font-size:9px; color:#666;"></span>
                        </div>
                        <div id="aiInsightContent" style="color:#aaa; font-size:11px; line-height:1.5;">
                            Click <b>Get Insight</b> after clicking <b>‚ú® Suggest</b> to get AI-powered trade recommendations.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- POSITIONS TAB -->
        <div class="tab-content active" id="positions">
            <div class="main-grid">
                <div class="canvas-section">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <h3 style="color:var(--accent-cyan); margin:0;">üìã Your Open Positions</h3>
                        <div style="display:flex; gap:6px; align-items:center;">
                            <span id="autoSaveStatus" style="font-size:10px; color:#666; padding:6px 8px;">‚ö™ Auto-save OFF</span>
                            <button onclick="setupAutoSave()" class="btn-toolbar" title="Pick a file location for automatic saving">üíæ Enable Auto-save</button>
                            <button onclick="exportAllData()" class="btn-toolbar">üì§ Export</button>
                            <label class="btn-toolbar" style="cursor:pointer;">
                                üì• Import
                                <input type="file" id="importFileInput" accept=".json" onchange="importAllData(event)" style="display:none;">
                            </label>
                            <button onclick="showBrokerImportModal()" class="btn-toolbar btn-accent" title="Import from broker export (Schwab, etc.)">üè¶ From Broker</button>
                        </div>
                    </div>
                    <div id="positionsTable"></div>
                    <div id="portfolioSummary" style="margin-top:20px;"></div>
                </div>
                <div class="controls-panel">
                    <!-- Paste Trade from Discord/Chat -->
                    <div id="pasteTradePanel2" style="margin-bottom:15px; padding:12px; background:rgba(139,92,246,0.08); border:1px solid rgba(139,92,246,0.3); border-radius:6px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                            <span style="color:#b9f; font-weight:bold; font-size:13px;">üìã Paste Trade Callout</span>
                            <button onclick="window.analyzeDiscordTrade()" class="btn-mini" style="font-size:11px; padding:4px 10px; background:rgba(139,92,246,0.3); border:1px solid rgba(139,92,246,0.5); color:#b9f;">üîç Analyze</button>
                        </div>
                        <textarea id="pasteTradeInput" placeholder="Paste a trade from Discord...

Ticker: TSLA
Strategy: Bull Put Spread
Strike: -$410, +$400
Expiry: Feb 27
Entry: $3.75" 
                            style="width:100%; height:80px; background:#0d0d1a; border:1px solid #333; border-radius:4px; color:#ddd; font-size:11px; padding:8px; resize:vertical; font-family:monospace;"></textarea>
                        <div style="font-size:9px; color:#666; margin-top:4px;">
                            Supports puts, calls, spreads. AI parses and analyzes.
                        </div>
                    </div>
                    
                    <h3 style="color:var(--accent-cyan); margin-bottom:15px;">‚ûï Add New Position</h3>
                    
                    <div class="control-group">
                        <label>Ticker</label>
                        <div style="display:flex; gap:5px;">
                            <input type="text" id="posTicker" class="value-input" placeholder="AAPL" style="flex:1; text-transform:uppercase;">
                            <button id="posFetchPriceBtn" class="btn-secondary" style="padding:6px 10px;">üìä Fetch</button>
                        </div>
                        <div id="posPriceStatus" style="font-size:11px; color:#888; margin-top:4px;"></div>
                    </div>
                    
                    <div class="control-group">
                        <label>Type</label>
                        <select id="posType" style="width:100%; padding:8px; background:rgba(0,217,255,0.15); border:1px solid rgba(0,217,255,0.3); border-radius:4px; color:#fff;" onchange="togglePositionTypeFields()">
                            <optgroup label="Single Leg">
                                <option value="short_put">Short Put (Cash Secured)</option>
                                <option value="short_call">Short Call (Covered)</option>
                                <option value="buy_write">Buy/Write (Stock + Call)</option>
                                <option value="long_put">Long Put</option>
                                <option value="long_call">Long Call</option>
                            </optgroup>
                            <optgroup label="Vertical Spreads">
                                <option value="call_debit_spread">Call Debit Spread (Bull Call)</option>
                                <option value="put_debit_spread">Put Debit Spread (Bear Put)</option>
                                <option value="call_credit_spread">Call Credit Spread (Bear Call)</option>
                                <option value="put_credit_spread">Put Credit Spread (Bull Put)</option>
                            </optgroup>
                            <optgroup label="LEAPS Strategies">
                                <option value="long_call_leaps">LEAPS Call (12+ months)</option>
                                <option value="skip_call">SKIP Call‚Ñ¢ (LEAPS + Shorter Call)</option>
                            </optgroup>
                        </select>
                    </div>
                    
                    <!-- Spread extra fields (hidden by default) -->
                    <div id="spreadFields" class="control-group" style="display:none; background:rgba(139,92,246,0.1); padding:12px; border-radius:8px; border:1px solid rgba(139,92,246,0.3);">
                        <div style="color:#8b5cf6; font-weight:bold; margin-bottom:10px;">üìä Spread Details</div>
                        <div class="control-row">
                            <div class="control-group" style="flex:1;">
                                <label>Buy Strike $</label>
                                <input type="number" id="posBuyStrike" class="value-input" min="1" max="5000" step="0.5" placeholder="170" style="width:100%;">
                            </div>
                            <div class="control-group" style="flex:1;">
                                <label>Sell Strike $</label>
                                <input type="number" id="posSellStrike" class="value-input" min="1" max="5000" step="0.5" placeholder="210" style="width:100%;">
                            </div>
                        </div>
                        <div style="font-size:11px; color:#888; margin-top:8px;" id="spreadExplanation">
                            üí° For Call Debit Spread: Buy lower strike, Sell higher strike
                        </div>
                    </div>
                    
                    <!-- Buy/Write extra fields (hidden by default) -->
                    <div id="buyWriteFields" class="control-group" style="display:none;">
                        <label>Stock Purchase Price $</label>
                        <input type="number" id="posStockPrice" class="value-input" min="0.01" max="10000" step="0.01" placeholder="e.g. 150.00" style="width:100%;">
                        <div style="font-size:10px; color:#888; margin-top:4px;">
                            Net cost basis = Stock - Premium received
                        </div>
                    </div>
                    
                    <!-- SKIP Strategy fields (hidden by default) -->
                    <div id="skipFields" class="control-group" style="display:none; background:rgba(255,215,0,0.1); padding:12px; border-radius:8px; border:1px solid rgba(255,215,0,0.3);">
                        <div style="color:#ffd700; font-weight:bold; margin-bottom:10px;">üéØ SKIP Call‚Ñ¢ Strategy</div>
                        <div style="font-size:11px; color:#aaa; margin-bottom:12px;">
                            Safely Keep Increasing Profits - Take profits on shorter calls while LEAPS rides the trend
                        </div>
                        <div style="background:rgba(0,0,0,0.2); padding:10px; border-radius:6px; margin-bottom:12px;">
                            <div style="color:#ffd700; font-size:11px; margin-bottom:8px;">üìä LEAPS POSITION (Core - 12+ months)</div>
                            <div class="control-row">
                                <div class="control-group" style="flex:1;">
                                    <label>LEAPS Strike $</label>
                                    <input type="number" id="posLeapsStrike" class="value-input" min="1" max="5000" step="0.5" placeholder="100" style="width:100%;">
                                </div>
                                <div class="control-group" style="flex:1;">
                                    <label>LEAPS Premium $</label>
                                    <input type="number" id="posLeapsPremium" class="value-input" min="0" max="500" step="0.01" placeholder="15.00" style="width:100%;">
                                </div>
                            </div>
                            <div class="control-group">
                                <label>üìÖ LEAPS Expiry</label>
                                <input type="date" id="posLeapsExpiry" style="width:100%; padding:6px; background:rgba(255,215,0,0.15); border:1px solid rgba(255,215,0,0.3); border-radius:4px; color:#fff;">
                            </div>
                        </div>
                        <div style="background:rgba(0,0,0,0.2); padding:10px; border-radius:6px;">
                            <div style="color:#00d9ff; font-size:11px; margin-bottom:8px;">‚ö° SKIP CALL (Shorter - 3-9 months)</div>
                            <div style="font-size:10px; color:#888; margin-bottom:8px;">Exit SKIP 45-60 days before expiry to capture gains</div>
                            <!-- Strike/Premium use main fields, Expiry uses main posExpiry -->
                        </div>
                    </div>
                    
                    <div class="control-row">
                        <div class="control-group">
                            <label>Strike $</label>
                            <input type="number" id="posStrike" class="value-input" min="1" max="5000" step="0.5" value="100" style="width:100%;">
                        </div>
                        <div class="control-group">
                            <label>Premium $</label>
                            <input type="number" id="posPremium" class="value-input" min="0" max="500" step="0.01" value="1.50" style="width:100%;">
                        </div>
                    </div>
                    
                    <div class="control-row">
                        <div class="control-group">
                            <label>Contracts</label>
                            <input type="number" id="posContracts" class="value-input" min="1" max="1000" step="1" value="1" style="width:100%;">
                        </div>
                        <div class="control-group">
                            <label>üìÖ Expiry</label>
                            <input type="date" id="posExpiry" style="width:100%; padding:6px; background:rgba(0,217,255,0.15); border:1px solid rgba(0,217,255,0.3); border-radius:4px; color:#fff;">
                        </div>
                    </div>
                    
                    <div class="control-row">
                        <div class="control-group" style="flex:1;">
                            <label>üóìÔ∏è Trade Opened</label>
                            <input type="date" id="posOpenDate" style="width:100%; padding:6px; background:rgba(0,217,255,0.15); border:1px solid rgba(0,217,255,0.3); border-radius:4px; color:#fff;">
                        </div>
                    </div>
                    
                    <div class="control-row">
                        <div class="control-group" style="flex:1;">
                            <label>üè¶ Broker</label>
                            <select id="posBroker" style="width:100%; padding:6px; background:rgba(0,217,255,0.15); border:1px solid rgba(0,217,255,0.3); border-radius:4px; color:#fff;">
                                <option value="Schwab">Schwab</option>
                                <option value="Robinhood">Robinhood</option>
                                <option value="Fidelity">Fidelity</option>
                                <option value="TD">TD Ameritrade</option>
                                <option value="IBKR">IBKR</option>
                                <option value="Webull">Webull</option>
                                <option value="Tastytrade">Tastytrade</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="control-group" style="flex:0.5;">
                            <label>Œî Delta</label>
                            <input type="number" id="posDelta" class="value-input" min="0" max="1" step="0.01" placeholder="0.30" style="width:100%;">
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 8px; margin-top: 15px;">
                        <button id="addPositionBtn" class="btn-success" style="flex:1;">‚ûï Add Position</button>
                        <button id="cancelEditBtn" class="btn-secondary" style="flex:0.4; display:none;">‚úï Cancel</button>
                    </div>
                    
                    <div style="margin-top:15px; padding:10px; background:rgba(255,170,0,0.1); border-radius:6px; font-size:12px; color:var(--accent-orange);">
                        üí° Positions are saved in your browser's local storage.
                    </div>
                </div>
                
                <!-- Roll Position Panel -->
                <div id="rollPanel" class="results-box" style="display:none; margin-top:15px; background:rgba(156,39,176,0.15); border:1px solid rgba(156,39,176,0.4);">
                    <h3 style="color:#ce93d8; margin-bottom:12px;">üîÑ Roll Position</h3>
                    <div id="rollCurrentInfo" style="background:rgba(0,0,0,0.3); padding:8px; border-radius:4px; margin-bottom:12px; font-size:12px; color:#aaa;"></div>
                    
                    <div class="control-group">
                        <label style="color:#ce93d8;">Closing Price (buy back old)</label>
                        <input type="number" id="rollClosingPrice" class="value-input" min="0" max="500" step="0.01" value="0" style="width:100%;">
                    </div>
                    
                    <div style="border-top:1px solid rgba(156,39,176,0.3); margin:12px 0; padding-top:12px;">
                        <div style="color:#ce93d8; font-weight:600; margin-bottom:8px;">New Position:</div>
                    </div>
                    
                    <div class="control-row">
                        <div class="control-group">
                            <label>New Strike $</label>
                            <input type="number" id="rollNewStrikeInput" class="value-input" min="1" max="5000" step="0.5" style="width:100%;">
                        </div>
                        <div class="control-group">
                            <label>New Premium $</label>
                            <input type="number" id="rollNewPremium" class="value-input" min="0" max="500" step="0.01" style="width:100%;">
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label>üìÖ New Expiry</label>
                        <input type="date" id="rollNewExpiryInput" style="width:100%; padding:6px; background:rgba(156,39,176,0.15); border:1px solid rgba(156,39,176,0.3); border-radius:4px; color:#fff;">
                    </div>
                    
                    <div id="rollNetDisplay" style="margin-top:10px; padding:8px; background:rgba(0,0,0,0.3); border-radius:4px; font-size:13px; text-align:center; display:none;">
                        Net: <span id="rollNetValue">‚Äî</span>
                    </div>
                    
                    <div style="display: flex; gap: 8px; margin-top: 12px;">
                        <button id="executeRollBtn" class="btn-success" style="flex:1; background:#9c27b0;">üîÑ Execute Roll</button>
                        <button id="cancelRollBtn" class="btn-secondary" style="flex:0.4;">‚úï Cancel</button>
                    </div>
                </div>
                
                <!-- Close Position Panel -->
                <div id="closePanel" class="results-box" style="display:none; margin-top:15px; background:rgba(0,255,136,0.1); border:1px solid rgba(0,255,136,0.4);">
                    <h3 style="color:var(--accent-green); margin-bottom:12px;">‚úÖ Close Position</h3>
                    <div id="closeCurrentInfo" style="background:rgba(0,0,0,0.3); padding:8px; border-radius:4px; margin-bottom:12px; font-size:12px; color:#aaa;"></div>
                    
                    <div class="control-group">
                        <label style="color:var(--accent-green);">Closing Price (what you paid to buy back)</label>
                        <input type="number" id="closeClosingPrice" class="value-input" min="0" max="500" step="0.01" value="0" style="width:100%;">
                        <div style="font-size:10px; color:#888; margin-top:4px;">Enter 0 if expired worthless</div>
                    </div>
                    
                    <div class="control-group">
                        <label>üìÖ Close Date</label>
                        <input type="date" id="closeDate" style="width:100%; padding:6px; background:rgba(0,255,136,0.15); border:1px solid rgba(0,255,136,0.3); border-radius:4px; color:#fff;">
                    </div>
                    
                    <div id="closePnLPreview" style="margin-top:10px; padding:10px; background:rgba(0,0,0,0.3); border-radius:4px; font-size:14px; text-align:center;">
                        P&L: <span id="closePnLValue" style="font-weight:bold;">‚Äî</span>
                    </div>
                    
                    <div style="display: flex; gap: 8px; margin-top: 12px;">
                        <button id="executeCloseBtn" class="btn-success" style="flex:1;">‚úÖ Confirm Close</button>
                        <button id="cancelCloseBtn" class="btn-secondary" style="flex:0.4;">‚úï Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- PORTFOLIO TAB -->
        <div class="tab-content" id="portfolio">
            <div class="main-grid">
                <div class="canvas-section" style="overflow-y: auto;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3 style="color:var(--accent-cyan); margin:0;">üíº Portfolio P&L Tracker</h3>
                        <div style="display:flex; gap:12px; align-items:center;">
                            <label style="display:flex; align-items:center; gap:4px; font-size:12px; cursor:pointer; color:#aaa;" title="Auto-refresh prices every 60 seconds from CBOE">
                                <input type="checkbox" id="autoRefreshCheckbox" style="cursor:pointer;">
                                üì° Auto (60s)
                            </label>
                            <button id="refreshPortfolioBtn" class="btn-primary" style="padding:6px 12px;">üîÑ Refresh Prices</button>
                        </div>
                    </div>
                    
                    <div id="portfolioLoading" style="display:none; text-align:center; padding:20px; color:var(--accent-orange);">
                        <div class="spinner" style="display:inline-block; margin-right:10px;"></div>
                        Fetching live prices...
                    </div>
                    
                    <div id="portfolioTable"></div>
                    
                    <!-- Holdings: Share Ownership from Assignments & Buy/Writes -->
                    <div id="holdingsSection" style="margin-top:20px; padding:15px; background:rgba(255,140,0,0.05); border-radius:8px; border:1px solid rgba(255,140,0,0.2); display:none;">
                        <h4 style="color:#fa0; margin:0 0 10px;">üì¶ Share Holdings (Wheel in Progress)</h4>
                        <div style="font-size:11px; color:#888; margin-bottom:10px;">Shares from Buy/Writes and Put Assignments</div>
                        <div id="holdingsTable" style="color:#888; font-size:13px;">No shares from assignments.</div>
                    </div>
                    
                    <div style="margin-top:20px; padding:15px; background:rgba(0,0,0,0.3); border-radius:8px;">
                        <h4 style="color:var(--accent-orange); margin:0 0 10px;">üìú Closed Positions</h4>
                        <div id="closedPositionsTable" style="color:#888; font-size:13px;">No closed positions yet.</div>
                    </div>
                </div>
                
                <div class="controls-panel">
                    <div class="results-box" style="background:rgba(0,255,136,0.1); border:1px solid rgba(0,255,136,0.3);">
                        <h3 style="color:var(--accent-green);">üìä Portfolio Summary</h3>
                        <div class="result-row"><span class="result-label">Open Positions:</span><span class="result-value" id="portOpenCount">0</span></div>
                        <div class="result-row"><span class="result-label">Total Premium Collected:</span><span class="result-value call" id="portTotalPremium">$0</span></div>
                        <div class="result-row"><span class="result-label">Capital at Risk:</span><span class="result-value" id="portCapitalRisk">$0</span></div>
                        <div style="border-top:1px solid rgba(255,255,255,0.2); margin:10px 0; padding-top:10px;">
                            <div class="result-row"><span class="result-label">Unrealized P&L:</span><span class="result-value" id="portUnrealizedPnL">$0</span></div>
                            <div class="result-row"><span class="result-label">Realized P&L:</span><span class="result-value" id="portRealizedPnL">$0</span></div>
                            <div class="result-row" style="font-size:16px; font-weight:bold;"><span class="result-label">Total P&L:</span><span class="result-value" id="portTotalPnL">$0</span></div>
                        </div>
                    </div>
                    
                    <div class="results-box" style="margin-top:15px;">
                        <h3 style="color:var(--accent-cyan);">üéØ Performance</h3>
                        <div class="result-row"><span class="result-label">Win Rate:</span><span class="result-value" id="portWinRate">‚Äî</span></div>
                        <div class="result-row"><span class="result-label">Avg Days Held:</span><span class="result-value" id="portAvgDays">‚Äî</span></div>
                        <div class="result-row"><span class="result-label">Best Trade:</span><span class="result-value" id="portBestTrade" style="cursor:pointer;">‚Äî</span></div>
                        <div class="result-row"><span class="result-label">Worst Trade:</span><span class="result-value" id="portWorstTrade" style="cursor:pointer;">‚Äî</span></div>
                    </div>
                    
                    <div style="margin-top:15px; padding:12px; background:rgba(0,217,255,0.1); border-radius:6px; font-size:12px;">
                        <div style="color:var(--accent-cyan); font-weight:600; margin-bottom:5px;">üí° How to Use</div>
                        <div style="color:#aaa;">
                            <b>‚úé Mark:</b> Enter current option price from Schwab<br>
                            <b>‚úì Close:</b> Lock in P&L when position expires/closes<br><br>
                            <b>P&L = </b> Premium received ‚àí current option price<br>
                            <i style="color:var(--accent-green);">Positive = theta decay working for you!</i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- GREEKS TAB -->
        <div class="tab-content" id="greeks">
            <div class="main-grid">
                <div class="canvas-section">
                    <h3 style="color:var(--accent-cyan); margin-bottom:10px;">üìê Greeks Visualization</h3>
                    <canvas id="greeksCanvas" width="800" height="200"></canvas>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-color" style="background:var(--accent-green)"></div>Call</div>
                        <div class="legend-item"><div class="legend-color" style="background:var(--accent-red)"></div>Put</div>
                    </div>
                </div>
                <div class="controls-panel">
                    <div class="control-group">
                        <label>Bump Size (for numerical differentiation)</label>
                        <input type="range" id="bumpSlider" min="0.005" max="0.05" step="0.005" value="0.01">
                    </div>
                    
                    <button id="greeksBtn" class="btn-primary" style="width:100%;">üßÆ Calculate Greeks</button>
                    
                    <div class="running" id="greekRunning"><div class="spinner"></div>Computing...</div>
                    
                    <div class="results-box greeks" style="margin-top:15px;">
                        <h3>üìê Call Greeks</h3>
                        <div class="greeks-grid">
                            <div class="greek-card"><div class="greek-symbol">Œî</div><div class="greek-value" id="callDelta">‚Äî</div><div class="greek-name">Delta</div></div>
                            <div class="greek-card"><div class="greek-symbol">Œì</div><div class="greek-value" id="callGamma">‚Äî</div><div class="greek-name">Gamma</div></div>
                            <div class="greek-card"><div class="greek-symbol">ŒΩ</div><div class="greek-value" id="callVega">‚Äî</div><div class="greek-name">Vega</div></div>
                        </div>
                    </div>
                    
                    <div class="results-box greeks" style="margin-top:15px;">
                        <h3>üìê Put Greeks</h3>
                        <div class="greeks-grid">
                            <div class="greek-card"><div class="greek-symbol">Œî</div><div class="greek-value" id="putDelta">‚Äî</div><div class="greek-name">Delta</div></div>
                            <div class="greek-card"><div class="greek-symbol">Œì</div><div class="greek-value" id="putGamma">‚Äî</div><div class="greek-name">Gamma</div></div>
                            <div class="greek-card"><div class="greek-symbol">ŒΩ</div><div class="greek-value" id="putVega">‚Äî</div><div class="greek-name">Vega</div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CHALLENGES TAB -->
        <div class="tab-content" id="challenges">
            <!-- Content rendered by challenges.js -->
        </div>

        <!-- DATA TAB -->
        <div class="tab-content" id="data">
            <div class="main-grid">
                <div class="canvas-section">
                    <h3 style="color:var(--accent-cyan); margin-bottom:10px;">üìä Simulation Data</h3>
                    <div id="dataContent"></div>
                </div>
                <div class="controls-panel">
                    <h3 style="color:var(--accent-cyan); margin-bottom:15px;">üíæ Export Options</h3>
                    <button class="btn-success" style="width:100%; margin-bottom:10px;" onclick="window.exportJSON()">üì• Export JSON</button>
                    <button class="btn-secondary" style="width:100%; margin-bottom:10px;" onclick="window.exportCSV()">üì• Export CSV</button>
                    <button class="btn-secondary" style="width:100%; margin-bottom:20px;" onclick="window.copyData()">üìã Copy to Clipboard</button>
                    
                    <!-- AI Trade Ideas Section -->
                    <div style="border-top:1px solid #333; padding-top:15px; margin-top:10px;">
                        <h3 style="color:#8b5cf6; margin-bottom:15px;">ü§ñ AI Trade Ideas</h3>
                        
                        <div class="input-group" style="margin-bottom:10px;">
                            <label style="font-size:11px; color:#888;">Buying Power ($)</label>
                            <input type="number" id="ideaBuyingPower" value="25000" min="1000" step="1000" 
                                   style="width:100%; padding:8px; background:#1a1a2e; border:1px solid #333; color:#ddd; border-radius:4px;">
                        </div>
                        
                        <div class="input-group" style="margin-bottom:10px;">
                            <label style="font-size:11px; color:#888;">Target Annual ROC (%)</label>
                            <input type="number" id="ideaTargetROC" value="25" min="5" max="100" step="5"
                                   style="width:100%; padding:8px; background:#1a1a2e; border:1px solid #333; color:#ddd; border-radius:4px;">
                        </div>
                        
                        <div class="input-group" style="margin-bottom:10px;">
                            <label style="font-size:11px; color:#888;">Sectors to Avoid (optional)</label>
                            <input type="text" id="ideaSectorsAvoid" placeholder="e.g., Tech, Energy"
                                   style="width:100%; padding:8px; background:#1a1a2e; border:1px solid #333; color:#ddd; border-radius:4px;">
                        </div>
                        
                        <div class="input-group" style="margin-bottom:15px;">
                            <label style="font-size:11px; color:#888;">Model <span style="color:#666; font-size:10px;">(32B best for ideas)</span></label>
                            <select id="ideaModelSelect" style="width:100%; padding:8px; background:#1a1a2e; border:1px solid #333; color:#ddd; border-radius:4px;">
                                <option value="qwen2.5:7b">Qwen 7B (Fast)</option>
                                <option value="qwen2.5:14b">Qwen 14B (Better)</option>
                                <option value="qwen2.5:32b" selected>Qwen 32B (Best) ‚≠ê</option>
                            </select>
                        </div>
                        
                        <button id="ideaBtn" class="btn-success" style="width:100%; background:linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);" 
                                onclick="window.getTradeIdeas()">
                            üí° Generate Ideas
                        </button>
                        
                        <div id="ideaResults" style="margin-top:15px; display:none; background:#0d0d1a; border-radius:8px; padding:12px; max-height:400px; overflow-y:auto;">
                            <div id="ideaContent" style="color:#ddd; font-size:12px; line-height:1.6; white-space:pre-wrap;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SETTINGS TAB -->
        <div class="tab-content" id="settings">
            <div style="max-width:800px; margin:0 auto;">
                <h2 style="color:var(--accent-cyan); margin-bottom:20px;">‚öôÔ∏è Settings</h2>
                <p style="color:#888; margin-bottom:25px; font-size:13px;">
                    Configure API keys for trading and AI analysis. Keys are stored securely on the server in .env file.
                </p>
                
                <!-- Schwab API Section -->
                <div style="background:#1a1a2e; border-radius:12px; padding:20px; margin-bottom:20px; border:1px solid #333;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3 style="color:#00ff88; margin:0;">
                            <span style="font-size:20px; margin-right:8px;">üìà</span> Schwab Trading API
                        </h3>
                        <span id="schwabStatus" style="padding:4px 12px; border-radius:12px; font-size:11px; background:#333; color:#888;">
                            Not Configured
                        </span>
                    </div>
                    <p style="color:#aaa; font-size:12px; margin-bottom:15px;">
                        Enable live trading and real-time account data. Get your API key from 
                        <a href="https://developer.schwab.com" target="_blank" style="color:#00d9ff;">developer.schwab.com</a>
                    </p>
                    
                    <div class="control-group" style="margin-bottom:12px;">
                        <label style="display:block; font-size:11px; color:#888; margin-bottom:4px;">App Key (Client ID)</label>
                        <input type="password" id="settingSchwabAppKey" placeholder="Enter Schwab App Key" 
                               style="width:100%; padding:10px; background:#0d0d1a; border:1px solid #444; border-radius:6px; color:#fff; font-family:monospace;">
                    </div>
                    
                    <div class="control-group" style="margin-bottom:12px;">
                        <label style="display:block; font-size:11px; color:#888; margin-bottom:4px;">App Secret</label>
                        <input type="password" id="settingSchwabAppSecret" placeholder="Enter Schwab App Secret" 
                               style="width:100%; padding:10px; background:#0d0d1a; border:1px solid #444; border-radius:6px; color:#fff; font-family:monospace;">
                    </div>
                    
                    <div class="control-group" style="margin-bottom:15px;">
                        <label style="display:block; font-size:11px; color:#888; margin-bottom:4px;">Refresh Token</label>
                        <input type="password" id="settingSchwabRefreshToken" placeholder="Generated after OAuth login" 
                               style="width:100%; padding:10px; background:#0d0d1a; border:1px solid #444; border-radius:6px; color:#fff; font-family:monospace;">
                        <div style="font-size:10px; color:#666; margin-top:4px;">
                            After saving App Key/Secret, click "Authenticate with Schwab" to generate this token.
                        </div>
                    </div>
                    
                    <div style="display:flex; gap:10px;">
                        <button onclick="testSchwabConnection()" 
                                style="padding:8px 16px; background:rgba(0,255,136,0.2); border:1px solid rgba(0,255,136,0.4); color:#0f8; border-radius:6px; cursor:pointer;">
                            üîå Test Connection
                        </button>
                        <button onclick="startSchwabOAuth()" 
                                style="padding:8px 16px; background:rgba(0,217,255,0.2); border:1px solid rgba(0,217,255,0.4); color:#0df; border-radius:6px; cursor:pointer;">
                            üîê Authenticate with Schwab
                        </button>
                    </div>
                </div>
                
                <!-- OpenAI Section -->
                <div style="background:#1a1a2e; border-radius:12px; padding:20px; margin-bottom:20px; border:1px solid #333;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3 style="color:#8b5cf6; margin:0;">
                            <span style="font-size:20px; margin-right:8px;">ü§ñ</span> OpenAI API
                        </h3>
                        <span id="openaiStatus" style="padding:4px 12px; border-radius:12px; font-size:11px; background:#333; color:#888;">
                            Not Configured
                        </span>
                    </div>
                    <p style="color:#aaa; font-size:12px; margin-bottom:15px;">
                        For AI-powered trade analysis (alternative to local Ollama).
                    </p>
                    
                    <div class="control-group" style="margin-bottom:15px;">
                        <label style="display:block; font-size:11px; color:#888; margin-bottom:4px;">API Key</label>
                        <input type="password" id="settingOpenAIKey" placeholder="sk-..." 
                               style="width:100%; padding:10px; background:#0d0d1a; border:1px solid #444; border-radius:6px; color:#fff; font-family:monospace;">
                    </div>
                    
                    <button onclick="testOpenAIConnection()" 
                            style="padding:8px 16px; background:rgba(139,92,246,0.2); border:1px solid rgba(139,92,246,0.4); color:#b9f; border-radius:6px; cursor:pointer;">
                        üîå Test Connection
                    </button>
                </div>
                
                <!-- Telegram Section -->
                <div style="background:#1a1a2e; border-radius:12px; padding:20px; margin-bottom:20px; border:1px solid #333;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3 style="color:#0088cc; margin:0;">
                            <span style="font-size:20px; margin-right:8px;">üì±</span> Telegram Notifications
                        </h3>
                        <span id="telegramStatus" style="padding:4px 12px; border-radius:12px; font-size:11px; background:#333; color:#888;">
                            Not Configured
                        </span>
                    </div>
                    <p style="color:#aaa; font-size:12px; margin-bottom:15px;">
                        Receive trade alerts on Telegram. Create a bot via @BotFather.
                    </p>
                    
                    <div class="control-group" style="margin-bottom:12px;">
                        <label style="display:block; font-size:11px; color:#888; margin-bottom:4px;">Bot Token</label>
                        <input type="password" id="settingTelegramToken" placeholder="123456789:ABC..." 
                               style="width:100%; padding:10px; background:#0d0d1a; border:1px solid #444; border-radius:6px; color:#fff; font-family:monospace;">
                    </div>
                    
                    <div class="control-group" style="margin-bottom:15px;">
                        <label style="display:block; font-size:11px; color:#888; margin-bottom:4px;">Chat ID</label>
                        <input type="text" id="settingTelegramChatId" placeholder="Your Telegram chat ID" 
                               style="width:100%; padding:10px; background:#0d0d1a; border:1px solid #444; border-radius:6px; color:#fff; font-family:monospace;">
                    </div>
                    
                    <button onclick="testTelegramConnection()" 
                            style="padding:8px 16px; background:rgba(0,136,204,0.2); border:1px solid rgba(0,136,204,0.4); color:#0df; border-radius:6px; cursor:pointer;">
                        üîå Test Connection
                    </button>
                </div>
                
                <!-- Save Button -->
                <div style="text-align:center; margin-top:30px;">
                    <button onclick="saveAllSettings()" 
                            style="padding:12px 40px; background:linear-gradient(135deg, #00ff88 0%, #00d9ff 100%); border:none; color:#0d0d1a; font-weight:bold; border-radius:8px; cursor:pointer; font-size:14px;">
                        üíæ Save All Settings
                    </button>
                    <div id="settingsSaveStatus" style="margin-top:10px; font-size:12px; color:#888;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Broker Import Utility (loads before ES6 modules) -->
    <script src="js/broker-import.js"></script>
    
    <!-- Theme Settings (loads before modules) -->
    <script src="js/theme.js"></script>
    
    <!-- Settings Management -->
    <script src="js/settings.js"></script>
    
    <!-- ES6 Module Entry Point -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
